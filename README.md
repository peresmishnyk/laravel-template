# Laravel Docker Template

Этот проект представляет собой шаблон для быстрого старта разработки приложений на Laravel с использованием Docker. Он включает настроенное окружение с PHP, Nginx, MySQL и Redis, а также Makefile для упрощения управления проектом.

## Требования

*   **Docker** и **Docker Compose**: Убедитесь, что они установлены и работают в вашей системе. ([Инструкция по установке Docker](https://docs.docker.com/get-docker/))
*   **Make**: Утилита `make` должна быть установлена. Обычно она доступна в большинстве \*nix систем. Для Windows можно использовать `make` из WSL или аналогичные инструменты.
*   **Git**: Для клонирования репозитория и управления версиями.

## Начало работы

1.  **Клонируйте репозиторий**:
    ```bash
    git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ> my-laravel-project
    cd my-laravel-project
    ```

2.  **Инициализируйте проект**:
    Эта команда выполнит все необходимые шаги для первого запуска: создаст `.env` файл из `env.example`, соберет Docker-образы, запустит контейнеры и сгенерирует ключ приложения (`APP_KEY`).
    ```bash
    make init
    ```
    После выполнения этой команды ваше приложение должно быть доступно по адресу `http://localhost` (или по значению `APP_URL` из вашего `.env` файла).

3.  **(Опционально) Установите зависимости Composer, если это не первый `make init` или вы добавили новые пакеты вручную:**
    ```bash
    make composer install
    ```

4.  **(Опционально) Выполните миграции базы данных:**
    ```bash
    make artisan migrate
    ```

## Файл окружения `.env`

При выполнении `make init` файл `.env` автоматически создается из `env.example`.
Файл `env.example` уже настроен для работы с Docker-сервисами, определенными в `docker-compose.yml`:
*   База данных: MySQL, хост `db`, порт `3306`.
*   Redis: хост `redis`, порт `6379`.
*   Драйверы сессий, кэша и очередей настроены на использование `redis`.

Вы можете отредактировать `.env` для изменения этих настроек, например, имени базы данных, пользователя, пароля (рекомендуется изменить стандартный пароль `password` на более надежный). После изменения `.env` может потребоваться перезапуск контейнеров (`make restart`).

## Доступные `make` команды

Ниже представлен список команд, доступных через `Makefile`. Вы можете также выполнить `make help` в терминале, чтобы увидеть этот список.

*   `make init`
    *   **Описание**: Инициализирует проект: настраивает `.env` и символические ссылки, собирает образы, запускает сервисы, генерирует `APP_KEY` и создает символическую ссылку для хранилища (`storage:link`).
    *   **Когда использовать**: При первом запуске проекта или после `make full-reset`.

*   `make up`
    *   **Описание**: Запускает сервисы в фоновом режиме.
    *   **Когда использовать**: Для запуска остановленных Docker-контейнеров.

*   `make down` (или `make stop`)
    *   **Описание**: Останавливает сервисы.
    *   **Когда использовать**: Для остановки Docker-контейнеров.

*   `make restart`
    *   **Описание**: Перезапускает сервисы (эквивалентно `make down && make up`).
    *   **Когда использовать**: Если нужно перезапустить все контейнеры, например, после изменения конфигурации.

*   `make build`
    *   **Описание**: Собирает или пересобирает сервисы.
    *   **Когда использовать**: Если вы изменили `Dockerfile` или другие файлы, влияющие на сборку образов.

*   `make logs`
    *   **Описание**: Показывает логи всех сервисов в реальном времени.
    *   **Когда использовать**: Для отслеживания работы всех контейнеров.

*   `make logs-app`
    *   **Описание**: Показывает логи сервиса приложения (`laravel_app`) в реальном времени.
    *   **Когда использовать**: Для отслеживания логов конкретно вашего Laravel-приложения.

*   `make ps`
    *   **Описание**: Показывает список запущенных контейнеров.
    *   **Когда использовать**: Для проверки статуса Docker-контейнеров.

*   `make shell`
    *   **Описание**: Предоставляет доступ к командной оболочке `sh` контейнера приложения.
    *   **Когда использовать**: Для выполнения команд внутри контейнера приложения (например, `php -v`).

*   `make bash`
    *   **Описание**: Предоставляет доступ к командной оболочке `bash` контейнера приложения (если `bash` установлен в контейнере).
    *   **Когда использовать**: Аналогично `make shell`, но с использованием `bash`.

*   `make artisan [команда_artisan]`
    *   **Описание**: Выполняет указанную команду Artisan внутри контейнера приложения.
    *   **Пример**: `make artisan migrate`, `make artisan queue:work`, `make artisan make:controller MyController`
    *   **Когда использовать**: Для выполнения любых команд Laravel Artisan.

*   `make composer [команда_composer]`
    *   **Описание**: Выполняет указанную команду Composer внутри контейнера приложения.
    *   **Пример**: `make composer install`, `make composer update`, `make composer require laravel/sanctum`
    *   **Когда использовать**: Для управления зависимостями PHP.

*   `make npm [команда_npm]`
    *   **Описание**: Выполняет указанную команду npm внутри контейнера приложения. Это полезно для управления JavaScript зависимостями и сборки фронтенд-ассетов.
    *   **Пример**: `make npm install`, `make npm run build`, `make npm run dev`
    *   **Когда использовать**: Для установки npm-пакетов, сборки ассетов (например, с помощью Vite, как в команде `make npm run build`) или запуска сервера разработки Vite (`make npm run dev`).

*   `make test`
    *   **Описание**: Запускает тесты PHPUnit.
    *   **Когда использовать**: Для запуска автоматизированных тестов вашего приложения.

*   `make clear-cache`
    *   **Описание**: Очищает различные кэши Laravel (optimize, cache, config, route, view).
    *   **Когда использовать**: Если у вас возникли проблемы, связанные с кэшированием.

*   `make permissions`
    *   **Описание**: Устанавливает корректные права доступа для директорий `storage` и `bootstrap/cache` внутри контейнера приложения. Запускается от имени `root`.
    *   **Когда использовать**: Если возникают проблемы с правами доступа на запись в эти директории.

*   `make full-reset`
    *   **Описание**: !! ОПАСНАЯ КОМАНДА !! Сохраняет незакоммиченные изменения в `git stash`, выполняет `git reset --hard HEAD` (сбрасывая все изменения в рабочей директории до последнего коммита), ПОЛНОСТЬЮ пересоздает окружение Docker (включая удаление всех томов Docker, что означает **потерю данных в БД**), удаляет симлинки `env` и `env.example`, и затем заново инициализирует проект с помощью `make init`.
    *   **Когда использовать**: Когда нужно полностью "обнулить" проект и начать с чистого листа, например, при серьезных проблемах с окружением или для тестирования процесса инициализации. **Используйте с большой осторожностью!** Сохраненные изменения можно будет восстановить из `git stash`.

*   `make help`
    *   **Описание**: Отображает экран справки со списком всех доступных `make` команд.

## Разработка

*   **Код вашего приложения Laravel** находится в стандартных директориях (`app`, `routes`, `resources` и т.д.).
*   **Файлы Docker** находятся в директории `docker/` (`Dockerfile`, `php/local.ini`, `nginx/default.conf`) и в корне проекта (`docker-compose.yml`).
*   **Конфигурация Nginx** находится в `docker/nginx/default.conf`.
*   **Конфигурация PHP** может быть дополнена в `docker/php/local.ini`.

## Устранение неисправностей

*   **Проблемы с правами доступа**: Попробуйте выполнить `make permissions`.
*   **Приложение не работает после изменений**: Проверьте логи с помощью `make logs` или `make logs-app`.
*   **Неожиданное поведение**: Попробуйте очистить кэш с помощью `make clear-cache`.
*   **Если ничего не помогает**: Можно рассмотреть `make full-reset`, но помните о потере данных в Docker-томах (например, в базе данных).

---

Надеемся, этот шаблон поможет вам быстро начать работу над вашим следующим проектом на Laravel!
